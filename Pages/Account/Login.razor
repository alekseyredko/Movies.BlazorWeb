@page "/login"

@inject ICustomAuthentication customAuthentication;
@inject NavigationManager NavigationManager


<h3>Log in</h3>

<h6>login</h6>
<input type="text" @bind-value="login"/>
<h6>Password</h6>
<input id="Password1" type="password" @bind-value="password"/>
<button @onclick="LogUsername">Login</button>

@if (response != null)
{
    @if (response.ResultType != ResultType.Ok)
    {
        <ErrorResult Result="response"/>
    }
}


@code {
    private string login { get; set; }
    private string password { get; set; }

    private Result<LoginUserResponse> response;

    [CascadingParameter] Task<AuthenticationState> authenticationStateTask { get; set; }

    private async Task LogUsername()
    {
        await authenticationStateTask;

        var userRequest = new LoginUserRequest()
        {
            Login = login,
            Password = password
        };
        response = await customAuthentication.TryLoginAsync(userRequest);
        if (response.ResultType == ResultType.Ok)
        {
            NavigationManager.NavigateTo("/");
        }
    }
}

